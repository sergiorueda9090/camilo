{% extends 'main/base.html' %}

{% block title %}{{ articulo.titulo }} | Dr. Camilo Soler Rueda{% endblock %}

{% block meta_tags %}
<!-- SEO Meta Tags -->
<meta name="description" content="{{ articulo.subtitulo|default:articulo.contenido|striptags|truncatewords:30 }}">
<meta name="author" content="{{ articulo.autor.nombre_completo }}">

<!-- Open Graph -->
<meta property="og:title" content="{{ articulo.titulo }}">
<meta property="og:description" content="{{ articulo.subtitulo|default:articulo.contenido|striptags|truncatewords:30 }}">
<meta property="og:type" content="article">
{% if articulo.imagen_destacada %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ articulo.imagen_destacada.url }}">
{% endif %}
{% endblock %}

{% block extra_css %}
/* ===== ESTILOS ESPECIFICOS PARA COMENTARIOS ===== */
.debate-section{
  background:#fff;
  border-top:3px solid var(--gold);
  padding:50px 0;
  margin-top:60px;
}
.debate-header{
  text-align:center;
  margin-bottom:50px;
}
.debate-title{
  font-family:'Playfair Display',serif;
  font-size:2rem;
  color:var(--blue);
  margin-bottom:15px;
}
.debate-subtitle{
  color:var(--muted);
  max-width:700px;
  margin:0 auto;
  font-size:.95rem;
  line-height:1.7;
}
{% endblock %}

{% block header %}
<!-- HEADER COMPACTO -->
<header class="header-compact">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center">
      <a href="{% url 'home' %}" class="header-logo">Camilo Soler Rueda</a>
      <nav class="nav-links d-none d-md-block">
        <a href="{% url 'home' %}">Inicio</a>
        <a href="#">Analisis</a>
        <a href="#">Jurisprudencia</a>
        <a href="#">Contacto</a>
      </nav>
    </div>
  </div>
</header>
{% endblock %}

{% block content %}
<!-- BREADCRUMBS -->
<div class="container">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb breadcrumb-editorial">
      <li class="breadcrumb-item"><a href="{% url 'home' %}">Inicio</a></li>
      {% if articulo.categoria %}
      <li class="breadcrumb-item"><a href="#">{{ articulo.categoria.nombre }}</a></li>
      {% endif %}
      <li class="breadcrumb-item active" aria-current="page">{{ articulo.titulo|truncatewords:5 }}</li>
    </ol>
  </nav>
</div>

<!-- HERO DEL ARTICULO -->
<section class="article-hero">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        {% if articulo.categoria %}
        <span class="article-category">{{ articulo.categoria.nombre }}</span>
        {% endif %}
        <h1 class="article-title">{{ articulo.titulo }}</h1>
        {% if articulo.subtitulo %}
        <p class="article-lead">{{ articulo.subtitulo }}</p>
        {% endif %}
        <div class="article-meta">
          <div class="meta-item">
            <i class="bi bi-person-circle"></i>
            <span>{{ articulo.autor.nombre_completo }}</span>
          </div>
          <div class="meta-item">
            <i class="bi bi-calendar3"></i>
            <span>{{ articulo.fecha_publicacion|date:"d \d\e F, Y" }}</span>
          </div>
          <div class="meta-item">
            <i class="bi bi-clock"></i>
            <span>{{ articulo.tiempo_lectura }} min de lectura</span>
          </div>
          <div class="meta-item">
            <i class="bi bi-eye"></i>
            <span>{{ articulo.vistas|default:0 }} lecturas</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- CONTENIDO PRINCIPAL -->
<main class="container my-5">
  <div class="row g-5">

    <!-- ARTICULO -->
    <div class="col-lg-8">

      {% if articulo.imagen_destacada %}
      <img src="{{ articulo.imagen_destacada.url }}"
           alt="{{ articulo.titulo }}"
           class="featured-image"
           loading="lazy">
      {% endif %}

      <article class="article-content">
        {{ articulo.contenido|safe }}
      </article>

      <!-- COMPARTIR -->
      <div class="share-section">
        <div class="share-title">Compartir este analisis</div>
        <div class="share-buttons">
          <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ articulo.titulo|urlencode }}"
             target="_blank"
             aria-label="Compartir en Twitter">
            <i class="bi bi-twitter-x"></i>
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
             target="_blank"
             aria-label="Compartir en Facebook">
            <i class="bi bi-facebook"></i>
          </a>
          <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri }}"
             target="_blank"
             aria-label="Compartir en LinkedIn">
            <i class="bi bi-linkedin"></i>
          </a>
          <a href="mailto:?subject={{ articulo.titulo|urlencode }}&body=Te%20recomiendo%20este%20articulo:%20{{ request.build_absolute_uri }}"
             aria-label="Compartir por correo">
            <i class="bi bi-envelope"></i>
          </a>
          <a href="#"
             onclick="navigator.clipboard.writeText(window.location.href); alert('Enlace copiado!');"
             aria-label="Copiar enlace">
            <i class="bi bi-link-45deg"></i>
          </a>
        </div>
      </div>

      <!-- AUTOR BOX -->
      {% if perfil %}
      <div class="author-box-article">
        {% if perfil.foto %}
        <img src="{{ perfil.foto.url }}" alt="{{ perfil.nombre_completo }}">
        {% else %}
        <img src="https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&w=300"
             alt="{{ perfil.nombre_completo }}">
        {% endif %}
        <div class="author-info">
          <h5>{{ perfil.nombre_completo }}</h5>
          <p>{{ perfil.descripcion }}</p>
          <div class="author-social">
            <a href="#" aria-label="Twitter"><i class="bi bi-twitter-x"></i></a>
            <a href="#" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
            <a href="#" aria-label="Email"><i class="bi bi-envelope"></i></a>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- NAVEGACION ARTICULOS -->
      {% if articulo_anterior or articulo_siguiente %}
      <div class="article-navigation">
        <div class="row g-3">
          <div class="col-md-6">
            {% if articulo_anterior %}
            <a href="{% url 'articulo_detalle' articulo_anterior.slug %}" class="nav-article text-decoration-none">
              <div>
                <i class="bi bi-arrow-left" style="font-size:1.5rem; color:var(--gold);"></i>
              </div>
              <div>
                <div class="nav-label">Articulo Anterior</div>
                <div class="nav-title">{{ articulo_anterior.titulo|truncatewords:6 }}</div>
              </div>
            </a>
            {% endif %}
          </div>
          <div class="col-md-6">
            {% if articulo_siguiente %}
            <a href="{% url 'articulo_detalle' articulo_siguiente.slug %}" class="nav-article text-decoration-none justify-content-end">
              <div class="text-end">
                <div class="nav-label">Siguiente Articulo</div>
                <div class="nav-title">{{ articulo_siguiente.titulo|truncatewords:6 }}</div>
              </div>
              <div>
                <i class="bi bi-arrow-right" style="font-size:1.5rem; color:var(--gold);"></i>
              </div>
            </a>
            {% endif %}
          </div>
        </div>
      </div>
      {% endif %}

    </div>

    <!-- SIDEBAR -->
    <aside class="col-lg-4">

      <!-- ARTICULOS POPULARES -->
      <div class="sidebar-box">
        <h5 class="sidebar-title">Mas Leidos</h5>

        {% for art in relacionados %}
        <div class="sidebar-item">
          <div class="sidebar-date">{{ art.fecha_publicacion|date:"F Y" }}</div>
          <h6><a href="{% url 'articulo_detalle' art.slug %}">{{ art.titulo }}</a></h6>
        </div>
        {% empty %}
        <p class="small text-muted">No hay articulos relacionados.</p>
        {% endfor %}
      </div>

      <!-- CAPSULAS JURIDICAS -->
      {% if capsulas %}
      <div class="capsules-box">
        <h6 class="capsules-title">Capsulas Juridicas</h6>

        {% for capsula in capsulas %}
        <div class="capsule-item">
          <h6>{{ capsula.titulo }}</h6>
          <p>{{ capsula.contenido|truncatewords:20 }}</p>
        </div>
        {% endfor %}
      </div>
      {% endif %}

    </aside>

  </div>
</main>

<!-- ARTICULOS RELACIONADOS -->
{% if relacionados %}
<section class="related-articles">
  <div class="container">
    <h3 class="mb-5 text-center">Articulos Relacionados</h3>
    <div class="row g-4">

      {% for art in relacionados %}
      <div class="col-md-4">
        <div class="related-card">
          {% if art.imagen_destacada %}
          <img src="{{ art.imagen_destacada.url }}"
               alt="{{ art.titulo }}"
               loading="lazy">
          {% else %}
          <img src="https://images.unsplash.com/photo-1505664194779-8beaceb93744?auto=format&fit=crop&w=400"
               alt="{{ art.titulo }}"
               loading="lazy">
          {% endif %}
          <div class="p-4">
            {% if art.categoria %}
            <div class="related-meta mb-2">{{ art.categoria.nombre }}</div>
            {% endif %}
            <h5><a href="{% url 'articulo_detalle' art.slug %}" class="text-decoration-none">{{ art.titulo }}</a></h5>
            <p class="small text-muted">
              {{ art.subtitulo|default:art.contenido|striptags|truncatewords:15 }}
            </p>
            <div class="d-flex align-items-center gap-2 small text-muted mt-3">
              <i class="bi bi-calendar3"></i>
              <span>{{ art.fecha_publicacion|date:"F Y" }}</span>
              <span class="ms-auto">{{ art.tiempo_lectura }} min</span>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}

    </div>
  </div>
</section>
{% endif %}
{% endblock %}

{% block subscribe %}{% endblock %}

{% block extra_js %}
<script>
// Smooth scroll
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault();
    const target = document.querySelector(this.getAttribute('href'));
    if(target) {
      target.scrollIntoView({
        behavior: 'smooth',
        block: 'start'
      });
    }
  });
});
</script>
{% endblock %}
